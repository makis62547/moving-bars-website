---
import CocktailIcon from "../components/icons/CocktailIcon.astro";

const { t, titleLine1, titleLine2, heroText } = Astro.props;

const cocktailsTitle = t?.underHero?.tiles?.cocktailsTitle ?? "";
const [cocktailsAccent, ...cocktailsRestParts] = cocktailsTitle.split(" ");
const cocktailsRest = cocktailsRestParts.join(" ").trim();

const mobileBarTitle = t?.underHero?.tiles?.mobileBarTitle ?? "";
const [mobileBarAccent, ...mobileBarRestParts] = mobileBarTitle.split(" ");
const mobileBarRest = mobileBarRestParts.join(" ").trim();

const base = (import.meta.env.BASE_URL || "/").replace(/\/?$/, "/");
const asset = (p) => `${base}${p.replace(/^\//, "")}`;

const introImage = asset("images/DEIN_INTRO_BILD.jpg");
const cocktailImage = asset("images/russian-wild-berry-cocktail.jpg");
const mobileBarImage = asset("images/mobile-cocktailbar-mit-rueckbuffet.jpg");
---

<section class="under-hero-tiles" aria-label="Ergänzende Informationen" data-uh-tiles>
  <div class="wide-rows" aria-label="Quadrat-Kacheln">
    <div class="wide-row">
      <!-- TEXT LINKS -->
      <article class="panel panel--text h1-panel top-row-panel">
        <div class="panel-inner">
          <h3 class="panel-title display-heading display-size-h1">
            <span class="accent-text">{titleLine1}</span><br />
            {titleLine2}
          </h3>
          <div class="panel-sep"></div>
          <p class="panel-text">{heroText}</p>
        </div>
      </article>

      <!-- ICON RECHTS -->
      <article class="panel panel--icon top-row-panel">
        <div class="icon-wrapper">
          <CocktailIcon class="big-cocktail-icon" />
        </div>
      </article>
    </div>

    <div class="wide-row">
     <article class="panel panel--slider is-align-left is-intro" data-panel-parallax data-speed="0.35">
  <div
    class="panel-bg"
    role="presentation"
    style="background-image: url('/images/cocktail-catering-moving-bars.jpg');"
  ></div>
</article>


      <article class="panel panel--text" aria-label="Private Feier Text">
        <div class="panel-inner">
          <h3 class="panel-title display-heading display-size-h1">
            PRIVATE FEIER – MESSEPARTY –
            <br />
            GROSSVERANSTALTUNG
          </h3>
          <div class="panel-sep" aria-hidden="true"></div>
          <p class="panel-text">
            {t.underHero.intro.paragraph}
          </p>
        </div>
      </article>
    </div>

    <!-- ROW 1: Text | Bild -->
    <div class="wide-row">
      <article class="panel panel--text" aria-label="Feinste Cocktails Text">
        <div class="panel-inner">
          <h3 class="panel-title display-heading display-size-h1">
            <span class="accent-text">{cocktailsAccent || cocktailsTitle}</span>
            {cocktailsRest ? ` ${cocktailsRest}` : ""}
          </h3>
          <div class="panel-sep" aria-hidden="true"></div>

          <p class="panel-text">
            {t.underHero.tiles.cocktailsText}
          </p>

          <a class="panel-cta" href="#" aria-label="Cocktail Menüs ansehen">HIER UNSERE COCKTAIL MENUS ANSEHEN</a>
        </div>
      </article>

      <article
        class="panel panel--slider is-align-left is-cocktail"
        aria-label="Feinste Cocktails Bild"
        data-panel-parallax
        data-speed="0.35"
      >
        <div class="panel-bg" role="presentation" style={`background-image: url(${cocktailImage});`}></div>
      </article>
    </div>

    <!-- ROW 2: Bild | Text -->
    <div class="wide-row">
      <article
        class="panel panel--slider is-align-right is-bar"
        aria-label="Mobile Bar Bild"
        data-panel-parallax
        data-speed="0.35"
      >
        <div class="panel-bg" role="presentation" style={`background-image: url(${mobileBarImage});`}></div>
      </article>

      <article class="panel panel--text" aria-label="Mobile Bar Text">
        <div class="panel-inner">
          <h3 class="panel-title display-heading display-size-h1">
            <span class="accent-text">{mobileBarAccent || mobileBarTitle}</span>
            {mobileBarRest ? ` ${mobileBarRest}` : ""}
          </h3>
          <div class="panel-sep" aria-hidden="true"></div>

          <p class="panel-text">
            {t.underHero.tiles.mobileBarText}
          </p>

          <a class="panel-cta" href="/anfrage" aria-label="Jetzt anfragen">JETZT ANFRAGEN</a>
        </div>
      </article>
    </div>
  </div>
</section>

<style>
  :root {
    --tile-height-top-row: 720px;  /* adjustable height for first row */
  }

  .under-hero-tiles {
    background: #000 !important;
    color: var(--text-color);
    padding-top: 0;
    padding-bottom: var(--under-hero-pad-bottom, 0);
    padding-left: var(--section-pad-inline);
    padding-right: var(--section-pad-inline);
    margin: 0;
    overflow-x: clip; /* verhindert 1px Scroll durch 100vw */
  }

  /* ---------- INTRO / H2 (unverändert) ---------- */
  .tile--intro { border: none; background: transparent; padding: 0; }

  .tile--intro .intro {
    display: grid;
    grid-template-columns: clamp(240px, 20vw, 320px) 1px minmax(0, 1fr);
    column-gap: clamp(1.25rem, 3vw, 3rem);
    align-items: center;
    width: 100%;
  }

  .tile--intro .intro__icon {
    justify-self: end;
    display: grid;
    place-items: center end;
    /* Icon-Farbe an die Akzent-Variable anbinden */
    color: var(--accent);
  }

  .tile--intro .intro__svg {
    width: min(260px, 100%);
    height: auto;
    display: block;
  }

  .tile--intro .intro__sep {
    align-self: stretch;
    background: rgba(var(--accent-rgb), 0.75);
  }

  .tile--intro .intro__copy { width: 100%; max-width: var(--section-text-width) !important; min-width: 0; }

  .tile--intro .intro__copy h2 {
    margin: 0;
    color: var(--heading-color);
    text-transform: uppercase;
  }

  .tile--intro .intro__copy .h2-line1 { white-space: nowrap; }

  .under-hero-tiles .tile--intro .intro__copy .intro__paragraph {
    margin: 1rem 0 0 !important;
    padding: 0 !important;
    width: 100% !important;
    max-width: none !important;
    max-inline-size: none !important;
    justify-self: stretch !important;
    color: rgba(247, 247, 247, 0.8);
    line-height: 1.7;
  }

  /* ---------- 2×2 Quadrate full-bleed ---------- */
  .wide-rows {
    /* echtes full-bleed: ignoriert Containerbreite und content pad */
    width: 100vw;
    margin-left: calc(50% - 50vw);
    margin-right: calc(50% - 50vw);
    display: grid;
    gap: 0;
    padding: 0;
    background: #000;
  }

  .wide-row {
    display: grid;
    grid-template-columns: 1fr;
    gap: 0;              /* ✅ kein Spalt */
    background: #000;    /* ✅ falls rounding, bleibt schwarz */
    align-items: stretch;
    margin: 0;
  }

  .wide-row + .wide-row { margin-top: 0; }

  @media (min-width: 900px) {
    .wide-row { grid-template-columns: 1fr 1fr; }
  }

  .panel {
    background: #000 !important;
    border: 0 !important;
    outline: 0 !important;
    box-shadow: none !important;
    border-radius: 0 !important;
    overflow: hidden;
    position: relative;
    margin: 0;

    min-height: var(--tile-height);
    height: var(--tile-height);
  }

  .panel--text {
    display: flex;
    flex-direction: column;
    justify-content: center;
    min-height: var(--tile-height);
    height: var(--tile-height);
    padding: clamp(1.25rem, 3vw, 2.25rem);
    padding-top: var(--tile-text-top-offset);
    padding-bottom: var(--tile-pad-y);
  }

  .panel--slider {
    position: relative;
    overflow: hidden;
    min-height: var(--tile-height);
    height: var(--tile-height);
  }

  .panel--slider {
    --bg-zoom: 24%;
    --bg-x: 50%;
    --bg-y: 50%;
  }

  .panel--slider.is-intro {
    --bg-zoom: 26%;
    --bg-x: 52%;
    --bg-y: 50%;
  }

  .panel--slider.is-cocktail {
    --bg-zoom: 70%;   /* vorher war’s zu wenig -> jetzt deutlich mehr */
    --bg-x: 50%;
    --bg-y: 50%;
  }

  .panel--slider.is-bar {
    --bg-zoom: 18%; /* Startwert: sollte die schwarzen Ränder killen */
    --bg-x: 50%;
    --bg-y: 50%;
  }

  .panel--slider .panel-bg {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    background-size: auto calc(100% + var(--bg-zoom));
    background-position: var(--bg-x) calc(var(--bg-y) + var(--py, 0px));
    background-repeat: no-repeat;
    background-color: #000;
    background-attachment: scroll;
    z-index: 0;
  }

  .panel-inner { max-width: var(--tile-text-width); display: grid; gap: var(--text-block-gap); }

  .panel-title {
    margin: 0;
    text-transform: uppercase;
    font-size: clamp(1.6rem, 2.4vw, 2.6rem);
    line-height: var(--heading-line-height);
    color: var(--heading-color);
  }

  .panel-title.display-size-h1 {
    font-size: clamp(2.25rem, 4.4vw, 3.25rem);
  }

  .panel-sep { height: 1px; background: rgba(var(--accent-rgb), 0.75); width: 100%; }

  .panel-text {
    margin: 0;
    color: rgba(247, 247, 247, 0.82);
    line-height: 1.7;
    font-family: "Inter", system-ui, sans-serif;
  }

  .panel-cta {
    display: inline-flex;
    justify-content: center;
    align-items: center;
    text-decoration: none;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    font-size: 0.95rem;
    padding: 0.95rem 1.1rem;
    border: 1px solid rgba(var(--accent-rgb), 0.6);
    color: rgba(var(--accent-rgb), 0.95);
    background: transparent;
    width: min(520px, 100%);
  }

  .panel-cta:hover,
  .panel-cta:focus-visible {
    outline: none;
    background: rgba(var(--accent-rgb), 0.14);
    border-color: rgba(var(--accent-rgb), 0.9);
  }

  .panel--icon {
    display: flex;
    align-items: center;
    justify-content: flex-start;
    padding-left: clamp(1rem, 3vw, 2rem);
    background: #000;
    height: var(--tile-height);
  }

  .panel--h1 .panel-sep {
    width: 1px;
    height: 100%;
  }

  .icon-wrapper {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 100%;
  }

  :global(.big-cocktail-icon) {
    width: clamp(180px, 24vw, 360px);
    height: auto;
    color: var(--accent);
    transform: translateY(var(--tile-icon-offset-y));
  }

  /* Text tiles top-aligned */
  .panel--text {
    justify-content: flex-start !important;
    align-items: flex-start !important;
  }

  /* Icon tile left-aligned */
  .panel--icon {
    justify-content: flex-start !important;
    align-items: flex-start !important;
  }

  .icon-wrapper {
    justify-content: flex-start !important;
    align-items: flex-start !important;
    width: auto !important;
  }

  /* Vertical divider in H1 panel */
  .panel--text.h1-panel {
    display: grid !important;
    grid-template-columns: minmax(0, 1fr) 1px !important;
    align-items: start !important;
  }

  .panel--text.h1-panel .panel-sep {
    width: 1px !important;
    height: 100% !important;
    align-self: stretch !important;
  }

  /* Separate height for the first tile row */
  .top-row-panel {
    height: var(--tile-height-top-row) !important;
    min-height: var(--tile-height-top-row) !important;
  }

  .panel--text .panel-inner {
    margin-left: auto;
    margin-right: auto;
  }

</style>

<script>
  const panels = Array.from(document.querySelectorAll("[data-panel-parallax]"));

  const updateParallax = () => {
    const viewportCenter = window.innerHeight / 2;

    panels.forEach((panel) => {
      if (panel instanceof HTMLElement) {
        const rect = panel.getBoundingClientRect();
        const distanceFromCenter = rect.top + rect.height / 2 - viewportCenter;
        const speed = Number(panel.dataset.speed ?? "0.3");

        panel.style.setProperty("--py", `${-distanceFromCenter * speed}px`);
      }
    });
  };

  const scheduleUpdate = () => {
    requestAnimationFrame(updateParallax);
  };

  updateParallax();
  window.addEventListener("scroll", scheduleUpdate, { passive: true });
  window.addEventListener("resize", scheduleUpdate);
</script>
