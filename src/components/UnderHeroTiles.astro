---
const sliderImages = [
  "/images/placeholder-1.jpg",
  "/images/placeholder-2.jpg",
  "/images/placeholder-3.jpg",
  "/images/placeholder-4.jpg",
];
import cocktailIconUrl from "../assets/icons/cocktail.svg?url";
---

<section class="under-hero-tiles" aria-label="Ergänzende Informationen" data-uh-tiles>
  <div class="tiles-shell">
    <!-- TILE 1 (Intro bleibt breit) -->
    <article class="tile tile--intro">
      <div class="intro">
        <div class="intro__icon" aria-hidden="true" style={`--cocktail-icon: url(${cocktailIconUrl})`}>
          <span class="intro__icon-mark"></span>
        </div>

        <div class="intro__sep" aria-hidden="true"></div>

        <div class="intro__copy">
          <h2>
            <span class="h2-line1">
              <span class="h2-accent">PRIVATE FEIER</span> – MESSEPARTY –
            </span>
            <br />
            GROSSVERANSTALTUNG
          </h2>

          <p class="intro__paragraph">
            Seit der Gründung im Jahr 2000 ist moving bars Ihr kompetenter Partner im Bereich Cocktail Catering und mobile
            Cocktailbar mieten auf Messen und Events in Berlin, Deutschland und ganz Europa. Vom Sektempfang bis zur
            Cocktailparty mit Showprogramm, bieten wir Ihnen professionelle Lösungen und begeistern mit der liebevollen
            Umsetzung Ihrer Wünsche! Unsere mobile Cocktailbar verwöhnt Sie und Ihre Gäste, damit Sie sich ganz auf Ihre
            Veranstaltung konzentrieren können.
          </p>
        </div>
      </div>
    </article>

    <!-- ✅ Ab hier: QUADRATISCHE KACHELN als Grid -->
    <div class="tiles-grid" aria-label="Platzhalter-Kacheln">
      <!-- TILE 2 (Square) -->
      <article class="tile tile--square">
        <div class="tile-copy">
          <p class="tile-label">Slider rechts</p>
          <p class="tile-text">
            Links Text, rechts ein horizontaler Slider mit quadratischen Bildern. Scrollbar oder per Buttons navigierbar.
          </p>
        </div>

        <div class="tile-visual">
          <div class="slider" data-slider>
            <button class="slider-btn prev" type="button" aria-label="Vorheriges Bild">‹</button>
            <div class="slider-track" tabindex="0">
              {sliderImages.map((src, index) => (
                <div class="slide" aria-label={`Platzhalterbild ${index + 1}`}>
                  <img
                    class="parallax-img"
                    data-parallax="1"
                    alt="Platzhalter"
                    src={src}
                    loading="lazy"
                    decoding="async"
                  />
                </div>
              ))}
            </div>
            <button class="slider-btn next" type="button" aria-label="Nächstes Bild">›</button>
          </div>
        </div>
      </article>

      <!-- TILE 3 (Square) – Copy oben, Slider unten (damit’s in Quadraten sauber wirkt) -->
      <article class="tile tile--square">
        <div class="tile-copy">
          <p class="tile-label">Slider links</p>
          <p class="tile-text">
            Quadratischer Slider + kurzer Blindtext. Inhalte folgen später.
          </p>
        </div>

        <div class="tile-visual">
          <div class="slider" data-slider>
            <button class="slider-btn prev" type="button" aria-label="Vorheriges Bild">‹</button>
            <div class="slider-track" tabindex="0">
              {sliderImages.map((src, index) => (
                <div class="slide" aria-label={`Platzhalterbild ${index + 1}`}>
                  <img
                    class="parallax-img"
                    data-parallax="1"
                    alt="Platzhalter"
                    src={src}
                    loading="lazy"
                    decoding="async"
                  />
                </div>
              ))}
            </div>
            <button class="slider-btn next" type="button" aria-label="Nächstes Bild">›</button>
          </div>
        </div>
      </article>

      <!-- TILE 4 (Square) -->
      <article class="tile tile--square">
        <div class="tile-visual icon" aria-hidden="true"></div>
        <div class="tile-copy">
          <p class="tile-label">Placeholder Headline</p>
          <p class="tile-text">
            Noch ein kurzer Blindtext mit Icon als Akzent. Alle Angaben sind temporär und dienen nur dem Layout-Test.
          </p>
        </div>
      </article>
    </div>
  </div>
</section>

<script is:inline>
  // --- Slider Controls + Parallax (robust) ---
  const onReady = () => {
    // Slider buttons
    document.querySelectorAll("[data-slider]").forEach((slider) => {
      const track = slider.querySelector(".slider-track");
      const prev = slider.querySelector(".slider-btn.prev");
      const next = slider.querySelector(".slider-btn.next");
      if (!track || !prev || !next) return;

      const scrollAmount = () => track.clientWidth * 0.9;
      prev.addEventListener("click", () => track.scrollBy({ left: -scrollAmount(), behavior: "smooth" }));
      next.addEventListener("click", () => track.scrollBy({ left: scrollAmount(), behavior: "smooth" }));
    });

    // Parallax
    const prefersReduced = window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches;
    const els = Array.from(document.querySelectorAll(".parallax-img"));
    if (prefersReduced || !els.length) return;

    let ticking = false;
    const clamp = (v, min, max) => Math.max(min, Math.min(max, v));

    const update = () => {
      ticking = false;
      const vh = window.innerHeight || 1;
      const viewportCenter = vh * 0.5;

      // Mehr sichtbar als vorher (sonst "merkt man nix")
      const baseAmp = 42;

      for (const el of els) {
        const r = el.getBoundingClientRect();
        const center = r.top + r.height * 0.5;
        const norm = (center - viewportCenter) / vh; // grob -1..1
        const speed = parseFloat(el.dataset.parallax || "1") || 1;
        const y = clamp(-norm * baseAmp * speed, -baseAmp * 1.6, baseAmp * 1.6);
        el.style.setProperty("--parallaxY", `${y}px`);
      }
    };

    const tick = () => {
      if (ticking) return;
      ticking = true;
      requestAnimationFrame(update);
    };

    window.addEventListener("scroll", tick, { passive: true });
    window.addEventListener("resize", tick);
    document.querySelectorAll(".slider-track").forEach((t) => t.addEventListener("scroll", tick, { passive: true }));

    tick();
  };

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", onReady);
  } else {
    onReady();
  }
</script>

<style>
  .under-hero-tiles {
    background: #000;
    color: #f7f7f7;
    padding: clamp(2.5rem, 6vw, 4.5rem) var(--content-pad) clamp(3rem, 8vw, 5rem);
  }

  .tiles-shell {
    max-width: min(1400px, 94vw);
    margin: 0 auto;
    display: grid;
    gap: clamp(1.5rem, 3vw, 2.25rem);
  }

  /* ✅ Neues Grid für die quadratischen Platzhalter-Kacheln */
  .tiles-grid {
    display: grid;
    gap: clamp(1.1rem, 2.2vw, 1.6rem);
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    align-items: stretch;
  }

  .tile {
    display: grid;
    grid-template-columns: 1fr;
    gap: clamp(1rem, 2.2vw, 1.25rem);
    padding: clamp(1.25rem, 2.6vw, 1.6rem);
    border: 1px solid rgba(255, 255, 255, 0.08);
    background: rgba(255, 255, 255, 0.02);
    border-radius: 18px;
  }

  .tile-visual {
    display: grid;
    place-items: center;
  }

  .tile-visual.icon {
    width: clamp(72px, 12vw, 96px);
    height: clamp(72px, 12vw, 96px);
    border-radius: 50%;
    background: radial-gradient(circle at 35% 35%, rgba(211, 139, 69, 0.9), rgba(211, 139, 69, 0.45));
    border: 1px solid rgba(211, 139, 69, 0.5);
    box-shadow: 0 0 0 8px rgba(211, 139, 69, 0.08);
  }

  .tile-copy {
    display: grid;
    gap: 0.35rem;
    font-family: "Inter", system-ui, sans-serif;
  }

  .tile-label {
    font-size: clamp(1.05rem, 2.2vw, 1.35rem);
    text-transform: uppercase;
    letter-spacing: 0.08em;
    margin: 0;
    color: #fff;
  }

  .tile-text {
    margin: 0;
    color: rgba(247, 247, 247, 0.8);
    line-height: 1.7;
    font-weight: 300;
  }

  /* ✅ Quadratisch + interne Aufteilung */
  .tile--square {
    aspect-ratio: 1 / 1;
    overflow: hidden;
    align-content: start;
    grid-template-rows: auto minmax(0, 1fr);
  }

  .tile--square .tile-visual {
    min-height: 0;
    align-self: stretch;
    place-items: stretch;
  }

  .tile--square .slider {
    height: 100%;
  }

  /* (Wichtig) Die alte Desktop-2-Spalten-Regel darf Square-Tiles NICHT betreffen */
  @media (min-width: 900px) {
    .tile:not(.tile--intro):not(.tile--square) {
      grid-template-columns: minmax(0, 0.95fr) minmax(0, 1.05fr);
      align-items: center;
    }
    .tile:not(.tile--intro):not(.tile--square):nth-of-type(2n) {
      grid-template-columns: minmax(0, 1.05fr) minmax(0, 0.95fr);
    }
  }

  /* TILE 1 */
  .tile--intro {
    border: none;
    background: transparent;
    padding: 0;
    border-radius: 0;
  }

  .tile--intro .intro {
    display: grid;
    grid-template-columns: clamp(240px, 20vw, 320px) 1px minmax(0, 1fr);
    column-gap: clamp(1.25rem, 3vw, 3rem);
    align-items: center;
    width: 100%;
  }

  .tile--intro .intro__icon {
    justify-self: end;
    display: flex;
    align-items: flex-start;
    justify-content: flex-end;
  }

  .tile--intro .intro__icon-mark {
    position: relative;
    width: clamp(168px, 22vw, 220px);
    aspect-ratio: 1;
    border-radius: 50%;
    background: radial-gradient(circle at 36% 34%, rgba(211, 139, 69, 0.35), rgba(211, 139, 69, 0.16)),
      rgba(211, 139, 69, 0.08);
    border: 1px solid rgba(211, 139, 69, 0.42);
    box-shadow: 0 0 0 10px rgba(211, 139, 69, 0.06);
    overflow: hidden;
  }

  .tile--intro .intro__icon-mark::after {
    content: "";
    position: absolute;
    inset: 20%;
    background: #d38b45;
    mask-image: var(--cocktail-icon);
    mask-repeat: no-repeat;
    mask-position: center;
    mask-size: contain;
    -webkit-mask-image: var(--cocktail-icon);
    -webkit-mask-repeat: no-repeat;
    -webkit-mask-position: center;
    -webkit-mask-size: contain;
    filter: drop-shadow(0 10px 22px rgba(0, 0, 0, 0.32));
  }

  .tile--intro .intro__sep {
    align-self: stretch;
    background: rgba(211, 139, 69, 0.75);
  }

  .tile--intro .intro__copy {
    width: 100%;
    max-width: none !important;
    min-width: 0;
  }

  .tile--intro .intro__copy h2 {
    margin: 0;
    color: #fff;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    font-weight: 500;
    font-size: clamp(1.8rem, 3.1vw, 3.2rem);
    line-height: 1.06;
  }

  .tile--intro .intro__copy .h2-accent {
    color: rgba(211, 139, 69, 0.95);
  }

  .tile--intro .intro__copy .h2-line1 {
    white-space: nowrap;
  }

  .under-hero-tiles .tile--intro .intro__copy .intro__paragraph {
    margin: 1rem 0 0 !important;
    padding: 0 !important;
    width: 100% !important;
    max-width: none !important;
    max-inline-size: none !important;
    justify-self: stretch !important;
    color: rgba(247, 247, 247, 0.8);
    line-height: 1.7;
    font-weight: 300;
  }

  /* =========================
     SLIDER + SQUARE TILES + PARALLAX
     => bewusst global, damit es IMMER greift
     ========================= */
  :global([data-uh-tiles] .slider) {
    position: relative;
    width: 100%;
  }

  :global([data-uh-tiles] .slider-track) {
    display: grid;
    grid-auto-flow: column;

    /* Kachelbreite im Slider */
    grid-auto-columns: clamp(150px, 16vw, 240px) !important;

    gap: 0.85rem;
    overflow-x: auto;
    padding: 0.25rem 0.5rem;
    scroll-snap-type: x mandatory;
    scroll-padding: 0.5rem;
    scrollbar-width: thin;

    /* ✅ in Square-Tiles darf der Track die Höhe nutzen */
    height: 100%;
    align-items: center;
  }

  :global([data-uh-tiles] .slider-track::-webkit-scrollbar) {
    height: 6px;
  }

  :global([data-uh-tiles] .slider-track::-webkit-scrollbar-thumb) {
    background: rgba(255, 255, 255, 0.2);
    border-radius: 999px;
  }

  /* ✅ Quadratische Slide-Kachel */
  :global([data-uh-tiles] .slide) {
    scroll-snap-align: start;
    border: 1px solid rgba(255, 255, 255, 0.12);
    background: rgba(255, 255, 255, 0.04);
    border-radius: 10px;
    overflow: hidden !important;
    position: relative !important;
    aspect-ratio: 1 / 1 !important;
  }

  /* ✅ Parallax: Bild größer als Container, bewegt sich in Y */
  :global([data-uh-tiles] .slide > .parallax-img) {
    position: absolute !important;
    inset: 0;
    width: 100%;
    height: 135%;
    object-fit: cover;
    display: block;
    transform: translate3d(0, var(--parallaxY, 0px), 0);
    will-change: transform;
    backface-visibility: hidden;
  }

  :global([data-uh-tiles] .slider-btn) {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(0, 0, 0, 0.65);
    color: #fff;
    border: 1px solid rgba(255, 255, 255, 0.2);
    width: 36px;
    height: 36px;
    border-radius: 50%;
    display: grid;
    place-items: center;
    cursor: pointer;
    transition: background 150ms ease, border-color 150ms ease, opacity 150ms ease;
    z-index: 2;
  }

  :global([data-uh-tiles] .slider-btn:hover),
  :global([data-uh-tiles] .slider-btn:focus-visible) {
    background: rgba(211, 139, 69, 0.95);
    border-color: rgba(211, 139, 69, 0.8);
    outline: none;
  }

  :global([data-uh-tiles] .slider-btn.prev) { left: 0; }
  :global([data-uh-tiles] .slider-btn.next) { right: 0; }

  @media (max-width: 720px) {
    :global([data-uh-tiles] .slider-btn) { display: none; }
  }

  @media (prefers-reduced-motion: reduce) {
    :global([data-uh-tiles] .slide > .parallax-img) {
      transform: none !important;
      height: 100% !important;
    }
  }
</style>
