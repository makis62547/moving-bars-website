---
const rows = [
  {
    textTitle: "Feinste Cocktails & Longdrinks",
    textBody:
      "Wenn Sie unsere mobile Cocktailbar mieten, mixen wir für Sie und Ihre Gäste klassische und moderne Cocktails und/oder Longdrinks aus besten Zutaten. Sprechen Sie mit uns – wir beraten Sie gerne.",
    cta: {
      href: "/cocktail-catering",
      label: "Hier unsere Cocktail Menüs ansehen",
    },
    slides: [
      { src: "/images/cocktail-catering-moving-bars.jpg", alt: "Cocktail Catering Bar mit beleuchtetem Tresen" },
      { src: "/images/cocktail-show-buchen-berlin.jpg", alt: "Barkeeper bei der Moving Bars Cocktail Show" },
    ],
    reverse: false,
  },
  {
    textTitle: "Mobile Bar mieten in Berlin",
    textBody:
      "Unsere mobile Bar ist das Ergebnis aus über 20 Jahren Erfahrung. Full Service, Barkeeper, Bar & Setup – alles aus einer Hand, damit Ihr Event reibungslos läuft.",
    cta: {
      href: "/anfrage",
      label: "Jetzt anfragen",
    },
    slides: [
      { src: "/images/mobile-bar-mieten-berlin.jpg", alt: "Elegante mobile Bar mit moderner Beleuchtung" },
      { src: "/images/kaffee-catering-berlin.jpg", alt: "Kaffee Catering Barista Station von Moving Bars" },
      { src: "/images/cocktailkurse-berlin.jpg", alt: "Shaker und Zutaten für einen Cocktailkurs" },
    ],
    reverse: true,
  },
];
---

<section class="under-hero-tiles" aria-label="Ergänzende Informationen" data-uh-tiles>
  <div class="tiles-shell">
    <!-- ✅ H2 / INTRO BLOCK: UNVERÄNDERT -->
    <article class="tile tile--intro">
      <div class="intro">
        <div class="intro__icon" aria-hidden="true">
          <svg class="intro__svg" viewBox="0 0 128 128" role="img" aria-label="">
            <g fill="currentColor">
              <circle cx="64" cy="42" r="18" />
              <path d="M34 108c0-18 14-32 30-32s30 14 30 32H34z" />
              <circle cx="30" cy="50" r="14" opacity="0.95" />
              <path d="M8 108c0-14 11-25 24-25s24 11 24 25H8z" opacity="0.95" />
              <circle cx="98" cy="50" r="14" opacity="0.95" />
              <path d="M72 108c0-14 11-25 24-25s24 11 24 25H72z" opacity="0.95" />
            </g>
          </svg>
        </div>

        <div class="intro__sep" aria-hidden="true"></div>

        <div class="intro__copy">
          <h2>
            <span class="h2-line1">
              <span class="h2-accent">PRIVATE FEIER</span> – MESSEPARTY –
            </span>
            <br />
            GROSSVERANSTALTUNG
          </h2>

          <p class="intro__paragraph">
            Seit der Gründung im Jahr 2000 ist moving bars Ihr kompetenter Partner im Bereich Cocktail Catering und mobile
            Cocktailbar mieten auf Messen und Events in Berlin, Deutschland und ganz Europa. Vom Sektempfang bis zur
            Cocktailparty mit Showprogramm, bieten wir Ihnen professionelle Lösungen und begeistern mit der liebevollen
            Umsetzung Ihrer Wünsche! Unsere mobile Cocktailbar verwöhnt Sie und Ihre Gäste, damit Sie sich ganz auf Ihre
            Veranstaltung konzentrieren können.
          </p>
        </div>
      </div>
    </article>

    <div class="wide-rows" aria-label="Text und Slider Kacheln">
      {rows.map((row, rowIndex) => (
        <div class="wide-row">
          <article class={`panel panel--text ${row.reverse ? "panel--text-right" : ""}`} aria-label="Textpanel">
            <div class="panel-inner">
              <p class="panel-kicker">Moving Bars</p>
              <h3 class="panel-title">{row.textTitle}</h3>
              <div class="panel-sep" aria-hidden="true"></div>
              <p class="panel-text">{row.textBody}</p>
              <a class="panel-cta" href={row.cta.href}>{row.cta.label}</a>
            </div>
          </article>

          <article class={`panel panel--slider ${row.reverse ? "panel--slider-left" : ""}`} aria-label="Bild-Slider">
            <div class="slider" data-slider>
              <button class="slider-btn prev" type="button" aria-label="Vorheriges Bild">‹</button>
              <div class="slider-track" tabindex="0" aria-label={`Bildergalerie ${rowIndex + 1}`}>
                {row.slides.map((slide, index) => (
                  <div class="slide" aria-label={`Bild ${index + 1}`}>
                    <img
                      class="parallax-img"
                      data-parallax="1"
                      alt={slide.alt}
                      src={slide.src}
                      loading="lazy"
                      decoding="async"
                    />
                  </div>
                ))}
              </div>
              <button class="slider-btn next" type="button" aria-label="Nächstes Bild">›</button>
              <div class="slider-fade slider-fade--left" aria-hidden="true"></div>
              <div class="slider-fade slider-fade--right" aria-hidden="true"></div>
            </div>
          </article>
        </div>
      ))}
    </div>
  </div>
</section>

<script is:inline>
  const onReady = () => {
    // Slider buttons
    document.querySelectorAll("[data-slider]").forEach((slider) => {
      const track = slider.querySelector(".slider-track");
      const prev = slider.querySelector(".slider-btn.prev");
      const next = slider.querySelector(".slider-btn.next");
      if (!track || !prev || !next) return;

      const scrollAmount = () => track.clientWidth;
      prev.addEventListener("click", () => track.scrollBy({ left: -scrollAmount(), behavior: "smooth" }));
      next.addEventListener("click", () => track.scrollBy({ left: scrollAmount(), behavior: "smooth" }));
    });

    // Parallax
    const prefersReduced = window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches;
    const els = Array.from(document.querySelectorAll(".parallax-img"));
    if (prefersReduced || !els.length) return;

    let ticking = false;
    const clamp = (v, min, max) => Math.max(min, Math.min(max, v));

    const update = () => {
      ticking = false;
      const vh = window.innerHeight || 1;
      const viewportCenter = vh * 0.5;
      const baseAmp = 42;

      for (const el of els) {
        const r = el.getBoundingClientRect();
        const center = r.top + r.height * 0.5;
        const norm = (center - viewportCenter) / vh;
        const speed = parseFloat(el.dataset.parallax || "1") || 1;
        const y = clamp(-norm * baseAmp * speed, -baseAmp * 1.6, baseAmp * 1.6);
        el.style.setProperty("--parallaxY", `${y}px`);
      }
    };

    const tick = () => {
      if (ticking) return;
      ticking = true;
      requestAnimationFrame(update);
    };

    window.addEventListener("scroll", tick, { passive: true });
    window.addEventListener("resize", tick);
    document.querySelectorAll(".slider-track").forEach((t) => t.addEventListener("scroll", tick, { passive: true }));
    tick();
  };

  if (document.readyState === "loading") document.addEventListener("DOMContentLoaded", onReady);
  else onReady();
</script>

<style>
  .under-hero-tiles{
    background: radial-gradient(circle at 20% 20%, rgba(211, 139, 69, 0.05), transparent 38%), #000;
    color:#f7f7f7;
    padding: clamp(2.5rem, 6vw, 4.5rem) var(--content-pad) clamp(3rem, 8vw, 5rem);
  }

  .tiles-shell{
    width: 100%;
    max-width: none;
    margin: 0;
    display: grid;
    gap: clamp(1.5rem, 3vw, 2.25rem);
  }

  .tile{ border-radius: 0; }

  .tile--intro{
    border: none;
    background: transparent;
    padding: 0;
  }

  .tile--intro .intro{
    display: grid;
    grid-template-columns: clamp(240px, 20vw, 320px) 1px minmax(0, 1fr);
    column-gap: clamp(1.25rem, 3vw, 3rem);
    align-items: center;
    width: 100%;
  }

  .tile--intro .intro__icon{
    justify-self: end;
    display: grid;
    place-items: center end;
    color: rgba(211, 139, 69, 0.95);
  }

  .tile--intro .intro__svg{ width: min(260px, 100%); height:auto; display:block; }
  .tile--intro .intro__sep{ align-self: stretch; background: rgba(211, 139, 69, 0.75); }
  .tile--intro .intro__copy{ width:100%; max-width:none!important; min-width:0; }

  .tile--intro .intro__copy h2{
    margin:0;
    color:#fff;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    font-weight: 500;
    font-size: clamp(1.8rem, 3.1vw, 3.2rem);
    line-height: 1.06;
  }

  .tile--intro .intro__copy .h2-accent{ color: rgba(211, 139, 69, 0.95); }
  .tile--intro .intro__copy .h2-line1{ white-space: nowrap; }

  .under-hero-tiles .tile--intro .intro__copy .intro__paragraph{
    margin: 1rem 0 0 !important;
    padding: 0 !important;
    width: 100% !important;
    max-width: none !important;
    max-inline-size: none !important;
    justify-self: stretch !important;
    color: rgba(247, 247, 247, 0.8);
    line-height: 1.7;
    font-weight: 300;
  }

  .wide-rows{
    display: grid;
    gap: 0;
  }

  .wide-row{
    display: grid;
    grid-template-columns: 1fr;
    gap: 0;
  }

  @media (min-width: 900px){
    .wide-row{
      grid-template-columns: 1fr 1fr;
    }

    .panel--slider-left{ order: -1; }
    .panel--text-right{ order: 1; }
  }

  .panel{
    border: none;
    border-radius: 0;
    background: rgba(255,255,255,0.02);
    min-height: clamp(340px, 40vw, 520px);
    overflow: hidden;
    display: grid;
  }

  .panel--text{
    background: #050505;
    padding: clamp(1.25rem, 3vw, 2.4rem);
    align-items: center;
    position: relative;
    isolation: isolate;
  }

  .panel--text::after{
    content: "";
    position: absolute;
    inset: 0;
    background: radial-gradient(circle at 18% 14%, rgba(211, 139, 69, 0.12), transparent 42%);
    opacity: 0.8;
    z-index: 0;
  }

  .panel-inner{
    max-width: 72ch;
    display: grid;
    gap: 0.9rem;
    position: relative;
    z-index: 1;
  }

  .panel-kicker{
    margin: 0;
    text-transform: uppercase;
    letter-spacing: 0.18em;
    font-size: 0.82rem;
    color: rgba(211, 139, 69, 0.9);
    font-weight: 600;
  }

  .panel-title{
    margin:0;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    font-weight: 500;
    font-size: clamp(1.6rem, 2.4vw, 2.6rem);
    line-height: 1.05;
  }

  .panel-sep{
    height: 1px;
    background: rgba(211, 139, 69, 0.75);
    width: 100%;
  }

  .panel-text{
    margin:0;
    color: rgba(247,247,247,0.84);
    line-height: 1.7;
    font-weight: 300;
    font-family: "Inter", system-ui, sans-serif;
  }

  .panel-cta{
    display: inline-flex;
    justify-content: center;
    align-items: center;
    text-decoration: none;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    font-size: 0.95rem;
    padding: 0.95rem 1.15rem;
    border: 1px solid rgba(211, 139, 69, 0.6);
    color: rgba(211, 139, 69, 0.95);
    background: transparent;
    width: min(520px, 100%);
  }

  .panel-cta:hover,
  .panel-cta:focus-visible{
    outline: none;
    background: rgba(211, 139, 69, 0.14);
    border-color: rgba(211, 139, 69, 0.9);
  }

  /* =========================
     SLIDER (1 Bild pro View, wie im Original)
     ========================= */
  :global([data-uh-tiles] .slider){
    position: relative;
    width: 100%;
    height: 100%;
  }

  :global([data-uh-tiles] .slider-track){
    display: flex;
    height: 100%;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
  }
  :global([data-uh-tiles] .slider-track::-webkit-scrollbar){ display:none; }

  :global([data-uh-tiles] .slide){
    flex: 0 0 100%;
    height: 100%;
    scroll-snap-align: start;
    position: relative;
    overflow: hidden;
    background: #0b0b0b;
  }

  :global([data-uh-tiles] .slide > .parallax-img){
    position: absolute;
    inset: 0;
    width: 100%;
    height: 120%;
    object-fit: cover;
    display: block;
    transform: translate3d(0, var(--parallaxY, 0px), 0);
    will-change: transform;
    backface-visibility: hidden;
  }

  :global([data-uh-tiles] .slide::after){
    content: "";
    position: absolute;
    inset: 0;
    background: linear-gradient(0deg, rgba(0,0,0,0.22) 0%, rgba(0,0,0,0) 40%);
  }

  :global([data-uh-tiles] .slider-btn){
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 44px;
    height: 44px;
    border-radius: 0;
    border: 1px solid rgba(255,255,255,0.22);
    background: rgba(0,0,0,0.55);
    color: #fff;
    display: grid;
    place-items: center;
    cursor: pointer;
    z-index: 2;
  }

  :global([data-uh-tiles] .slider-btn:hover),
  :global([data-uh-tiles] .slider-btn:focus-visible){
    outline: none;
    background: rgba(211, 139, 69, 0.92);
    border-color: rgba(211, 139, 69, 0.92);
  }

  :global([data-uh-tiles] .slider-btn.prev){ left: 12px; }
  :global([data-uh-tiles] .slider-btn.next){ right: 12px; }

  .slider-fade{
    position: absolute;
    top: 0;
    bottom: 0;
    width: clamp(28px, 4vw, 48px);
    pointer-events: none;
    background: linear-gradient(90deg, #000 0%, rgba(0,0,0,0) 100%);
    z-index: 1;
  }

  .slider-fade--left{ left: 0; }
  .slider-fade--right{ right: 0; transform: scaleX(-1); }

  @media (max-width: 720px){
    :global([data-uh-tiles] .slider-btn){ display:none; }
    .panel{ min-height: clamp(280px, 72vw, 420px); }
    .panel-cta{ width: 100%; justify-content: center; }
  }

  @media (prefers-reduced-motion: reduce){
    :global([data-uh-tiles] .slide > .parallax-img){
      transform: none !important;
      height: 100% !important;
    }
  }
</style>
