---
import { i18n, type Lang } from "../i18n";

const {
  exclude,
  headline = "DEINE WÜNSCHE – UNSERE LEISTUNGEN",
  t: passedT,
  lang: passedLang,
} = Astro.props as {
  exclude?: string;
  headline?: string;
  t?: (typeof i18n)["de"];
  lang?: Lang;
};

const pathLang = Astro.url?.pathname?.split("/")[1];
const lang = (passedLang ?? (pathLang === "en" ? "en" : pathLang === "de" ? "de" : undefined) ?? "de") as Lang;
const t = passedT ?? i18n[lang] ?? i18n.de;

const translateKey = (key: string) => key.split(".").reduce((acc: Record<string, any> | undefined, part) => acc?.[part], t);

const services = [
  {
    slug: "cocktail-catering",
    title: "Full Service Cocktail Catering",
    excerpt: "Profitiere von 20 Jahren Erfahrung im Bereich Cocktail Catering und mobile Cocktailbar mieten in Berlin und Deutschland. Wir bieten Dir ein RundumSorglos-Paket, das alles enthält und Du Dich um nichts weiter kümmern müssen. Die mobile Cocktailbar, alle benötigten Zutaten, Gläser und Eis werden von uns geliefert. Professionelle Barkeeper kümmern sich um Deine Gäste.",
    href: "/cocktail-catering",
    ctaKey: "cta.learnMore",
    ctaFallback: "Mehr erfahren",
  },
  {
    slug: "mobile-bar",
    title: "Mobile Bar mieten",
    excerpt: "Du suchst eine mobile Bar für Deine Feier, Veranstaltung oder Deinen Event in Berlin? Dann haben wir ganz sicher eine passende Lösung für Dich. Unser Barsystem passt sich jeder Veranstaltungsgröße an. Verschiedene Kombinationsmöglichkeiten und flexible Beleuchtung lassen keine Wünsche offen. Mit oder ohne beleuchtetes Rückbuffet ist unsere mobile Bar das optische Highlight Deiner Veranstaltung.",
    href: "/mobile-bar",
    ctaKey: "cta.viewDetails",
    ctaFallback: "Details ansehen",
  },
  {
    slug: "cocktail-show",
    title: "Cocktail Show & Showbarkeeper",
    excerpt: "Du willst noch mehr? Entertainment und Unterhaltung für Deine Gäste? Buche zusätzlich für die mobile Cocktailbar in Berlin einen Showbarkeeper oder eine Cocktailshow. Wirbelnde Flaschen und Shaker, Cocktailartistik während der Herstellung der Cocktails oder eröffne die mobile Cocktailbar mit einer Cocktailshow.",
    href: "/cocktail-show",
    ctaKey: "cta.toShow",
    ctaFallback: "Zur Show",
  },
  {
    slug: "cocktailkurse",
    title: "Mobiler Cocktailkurs",
    excerpt: "Cocktailkurs, Schulung oder Cocktailworkshop - Wir geben unser Wissen weiter. Vom Einsteiger bis zum Profi - Wir haben für jeden das passende Programm. Als Highlight auf Deiner privaten Feier oder als Incentive mit Deinen Mitarbeitern. Wir bringen alles mit und zeigen Euch wie man Cocktails mixt. Analog in Berlin, Leipzig, Hamburg, München...deutschlandweit oder ONLINE als Teil Deines virtuellen Teamevents.",
    href: "/cocktailkurse",
    ctaKey: "cta.bookNow",
    ctaFallback: "Jetzt buchen",
  },
  {
    slug: "kaffeecatering",
    title: "Kaffee Catering & Barista Service",
    excerpt: "Auch bei Heißgetränken wie Kaffee, Espresso, Latte Macchiato, Cappuccino und Tee-Spezialitäten sind wir Dein kompetenter Ansprechpartner für Berlin und Deutschland. Wir bieten IhDirnen perfekten Service bei bester Qualität! Espresso Maschinen, Personal, Kaffee-Auswahl - Wir beraten Dich gerne! Unsere zertifizierten Kaffee Barista und Latte Art Künstler verwöhnen Dich und Deine Gäste mit feinstem Kaffee - Genuss.",
    href: "/kaffeecatering",
    ctaKey: "cta.viewAll",
    ctaFallback: "Alles ansehen",
  },
];

const servicesWithCtas = services.map((service) => ({
  ...service,
  cta: translateKey(service.ctaKey) ?? service.ctaFallback,
}));

const visible = servicesWithCtas.filter((service) => service.slug !== exclude);
---

<section class="services-overview parallax-section" aria-label="Unsere Leistungen">
  <div
    class="services-bg parallax-bg"
    role="presentation"
    style="background-image: url('/images/hero.jpg'); opacity: var(--services-bg-opacity);"
  ></div>
  <div class="services-overlay" aria-hidden="true"></div>

  <div class="services-content">
    <div class="services-shell">
      <header class="services-heading">
        <div class="services-head">
          <h2 class="services-title">{headline}</h2>
          <span class="services-divider" aria-hidden="true"></span>
        </div>
      </header>

      <div
        class:list={{
          "services-grid": true,
          "is-count-5": visible.length === 5,
        }}
        role="list"
      >
        {visible.map((service) => (
          <article class="service-card" role="listitem" aria-label={service.title}>
            <div
              class:list={{
                "service-media": true,
                [`is-${service.slug}`]: true,
              }}
              aria-hidden="true"
            ></div>

            <div class="service-body">
              <h3 class="service-title">{service.title}</h3>
              <p class="service-excerpt">{service.excerpt}</p>
            </div>

            <a class="service-cta mb-btn" href={service.href}>{service.cta}</a>
          </article>
        ))}
      </div>
    </div>
  </div>
</section>

<style>
  .services-overview {
    --services-card-radius: 0px;

    position: relative;
    width: 100vw;
    margin-left: calc(50% - 50vw);
    margin-right: calc(50% - 50vw);
    overflow: hidden;
    padding: var(--services-pad-block) var(--services-pad-inline);
    color: var(--text-color);
    background: #000;
  }

  .services-bg {
    position: absolute;
    inset: -2px;
    z-index: 1;
    background-size: cover !important;
    background-position: center center !important;
    background-repeat: no-repeat !important;
    background-color: #000;
    will-change: transform;
  }

  .services-overlay {
    position: absolute;
    inset: -2px;
    background: rgba(0, 0, 0, var(--services-overlay-opacity));
    z-index: 2;
  }

  .services-content {
    position: relative;
    z-index: 3;
  }

  .services-shell {
    max-width: var(--services-max-width);
    margin: 0 auto;
    display: grid;
    gap: clamp(2rem, 4vw, 3rem);
  }

  .services-heading {
    display: grid;
    justify-items: start;
    gap: var(--services-heading-gap);
    text-transform: uppercase;
    letter-spacing: 0.06em;
  }

  .services-head {
    display: grid;
    width: 100%;
    max-width: var(--services-max-width);
  }

  .services-title {
    margin: 0;
    font-size: clamp(2rem, 4.5vw, 3rem);
    color: var(--heading-color);
  }

  .services-divider {
    display: inline-block;
    width: var(--services-divider-width);
    height: var(--services-divider-height);
    margin-top: var(--services-divider-gap);
    background: var(--accent);
  }

  .services-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(var(--services-card-width), 1fr));
    gap: var(--services-grid-gap);
    justify-items: center;
  }

  .service-card {
    width: 100%;
    max-width: var(--services-card-width, 320px);
    background: var(--services-card-bg);
    border: none !important;
    border-radius: 0;
    box-shadow: var(--services-card-glow);
    padding: clamp(1.25rem, 2.2vw, 1.6rem);
    display: grid;
    grid-template-rows: auto 1fr auto;
    gap: clamp(1rem, 1.8vw, 1.25rem);
  }

  .service-media {
    width: 100%;
    aspect-ratio: var(--services-card-img-ratio);
    border-radius: 0;
    background: linear-gradient(135deg, rgba(var(--accent-rgb), 0.35), rgba(var(--accent-rgb), 0.08));
    border: none !important;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
  }

  .service-media.is-cocktail-catering {
    background-image: url("/images/cocktail-catering-moving-bars.jpg");
  }

  .service-media.is-mobile-bar {
    background-image: url("/images/mobile-bar-mieten.jpg");
  }

  .service-media.is-cocktail-show {
    background-image: url("/images/cocktailshow-berlin.jpg");
  }

  .service-media.is-cocktailkurse {
    background-image: url("/images/mobiler-cocktailkurs-berlin.jpg");
  }

  .service-media.is-kaffeecatering {
    background-image: url("/images/kaffee-catering.jpg");
  }

  .service-body {
    display: grid;
    gap: clamp(0.5rem, 1.2vw, 0.85rem);
  }

  .service-title {
    margin: 0;
    font-size: clamp(1.15rem, 1.6vw, 1.35rem);
    text-transform: uppercase;
    letter-spacing: 0.04em;
    color: var(--heading-color);
  }

  .service-excerpt {
    margin: 0;
    color: rgba(255, 255, 255, 0.82);
    line-height: 1.6;
  }

  @media (min-width: 900px) {
    .services-grid {
      grid-template-columns: repeat(12, 1fr);
      justify-items: stretch;
    }

    .service-card {
      max-width: none;
      grid-column: span 4;
    }

    .services-grid.is-count-5 > .service-card:nth-child(4) {
      grid-column: 3 / span 4;
    }

    .services-grid.is-count-5 > .service-card:nth-child(5) {
      grid-column: 7 / span 4;
    }
  }

  @media (max-width: 820px) {
    .services-overview {
      padding-inline: var(--content-pad);
    }
  }
</style>
