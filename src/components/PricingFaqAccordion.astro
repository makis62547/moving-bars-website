---
import { pricing } from "../data/pricing/pricing";
import { i18n, type Lang } from "../i18n";

const formatMoney = (value: number | null) => {
  if (value === null) return "auf Anfrage";

  return new Intl.NumberFormat("de-DE", {
    style: "currency",
    currency: pricing.currency,
    minimumFractionDigits: 2,
  }).format(value / 100);
};

const { t: passedT, lang: passedLang } = Astro.props as { t?: (typeof i18n)["de"]; lang?: Lang };
const pathLang = Astro.url?.pathname?.split("/")[1];
const lang = (passedLang ?? (pathLang === "en" ? "en" : pathLang === "de" ? "de" : undefined) ?? "de") as Lang;
const t = passedT ?? i18n[lang] ?? i18n.de;
const faq = t?.faqMobileCocktailbar;

const faqItems = faq
  ? [
      { question: faq.q1, answer: faq.a1 },
      { question: faq.q2, answer: faq.a2 },
      { question: faq.q3, answer: faq.a3 },
      { question: faq.q4, answer: faq.a4 },
      { question: faq.q5, answer: faq.a5 },
      { question: faq.q6, answer: faq.a6 },
      { question: faq.q7, answer: faq.a7 },
      { question: faq.q8, answer: faq.a8 },
      { question: faq.q9, answer: faq.a9 },
      { question: faq.q10, answer: faq.a10 },
    ]
  : [];

const faqButtonLabel = faq?.buttonLabel ?? "FAQ";
---

<div class="h1-accordion">
  <details class="h1-acc-item">
    <summary class="panel-cta">Hier alle Pakete und Preise</summary>
    <div class="h1-acc-fullbleed">
      <div class="h1-acc-fullbleed-inner">
        <div class="accordion-content">
          <div class="table-wrapper">
            <table class="pricing-table">
              <thead>
                <tr>
                  <th scope="col">Paket</th>
                  <th scope="col">Empfohlen f체r</th>
                  <th scope="col">Drinks inkl.</th>
                  <th scope="col">Barkeeper</th>
                  <th scope="col">Bar-Setup</th>
                  <th scope="col">Ohne R체ckbuffet</th>
                  <th scope="col">Mit R체ckbuffet</th>
                </tr>
              </thead>
              <tbody>
                {pricing.packages.map((pkg) => (
                  <tr id={pkg.id}>
                    <th scope="row">{pkg.title}</th>
                    <td>{pkg.recommendedFor}</td>
                    <td>{pkg.drinksIncluded}</td>
                    <td>{pkg.bartenders}</td>
                    <td>{pkg.barSetup}</td>
                    <td
                      data-price-no-backbar-cents={pkg.priceNoBackbarCents ?? undefined}
                      data-currency={pricing.currency}
                    >
                      {formatMoney(pkg.priceNoBackbarCents)}
                    </td>
                    <td
                      data-price-with-backbar-cents={pkg.priceWithBackbarCents ?? undefined}
                      data-currency={pricing.currency}
                    >
                      {formatMoney(pkg.priceWithBackbarCents)}
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>

          <div class="pricing-notes">
            <p class="note-kicker">Hinweise</p>
            <p class="note-text">{pricing.vatNote}</p>
            <p class="note-text">Jeder weitere Cocktail/Longdrink: {formatMoney(pricing.notes.extraDrinkNetCents)}</p>
            <p class="note-text">Gl채serschwund: {formatMoney(pricing.notes.glassLossNetCents)} pro Glas</p>
            <p class="note-text">Fahrtkosten: erst ab {pricing.notes.freeKm} km (nach Aufwand)</p>
          </div>
        </div>
      </div>
    </div>
  </details>

  <details class="h1-acc-item">
    <summary class="panel-cta">{faqButtonLabel}</summary>
    <div class="h1-acc-fullbleed">
      <div class="h1-acc-fullbleed-inner">
        <div class="accordion-content">
          <div class="faq-block">
            {faqItems.map((item) => (
              <div class="faq-item">
                <h3 class="faq-q">{item.question}</h3>
                <p class="faq-a">{item.answer}</p>
              </div>
            ))}
          </div>
        </div>
      </div>
    </div>
  </details>
</div>

<style>
  .h1-accordion {
    width: min(100%, var(--h1-accordion-width));
    display: flex;
    flex-direction: column;
    gap: var(--h1-accordion-gap);
    padding-top: var(--h1-accordion-pad-top);
  }

  .h1-acc-item {
    border: 0;
    padding: 0;
    background: none;
    overflow: visible;
  }

  .h1-acc-item summary {
    list-style: none;
    cursor: pointer;
    display: block;
    width: 100%;
    box-sizing: border-box;
  }

  .h1-acc-item summary::-webkit-details-marker {
    display: none;
  }

  details[open] {
    margin-bottom: var(--h1-accordion-open-gap-bottom);
  }

  .h1-acc-fullbleed {
    width: 100vw;
    margin-left: calc(50% - 50vw);
    margin-right: calc(50% - 50vw);
    padding-left: var(--h1-accordion-fullbleed-pad-inline);
    padding-right: var(--h1-accordion-fullbleed-pad-inline);
    margin-top: var(--h1-accordion-fullbleed-gap-top);
  }

  .h1-acc-fullbleed-inner {
    max-width: var(--h1-accordion-fullbleed-max-width);
    margin: 0 auto;
  }

  .accordion-content {
    display: grid;
    gap: var(--h1-accordion-gap);
    padding-top: var(--h1-accordion-pad-top);
  }

  .table-wrapper {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }

  .pricing-table {
    width: 100%;
    min-width: 720px;
    border-collapse: collapse;
    color: var(--text-color);
  }

  .pricing-table th,
  .pricing-table td {
    text-align: left;
    padding: 0.8rem 0.65rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.12);
    vertical-align: top;
    font-family: var(--body-font-family);
  }

  .pricing-table thead th {
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.02em;
    color: rgba(255, 255, 255, 0.92);
  }

  .pricing-table tbody th {
    font-weight: 700;
    width: 22%;
  }

  .pricing-table tbody td {
    color: rgba(255, 255, 255, 0.86);
  }

  .pricing-notes {
    display: grid;
    gap: 0.4rem;
    padding: clamp(0.85rem, 1.4vw, 1rem);
    border: 1px solid rgba(255, 255, 255, 0.12);
    background: rgba(255, 255, 255, 0.03);
  }

  .note-kicker {
    margin: 0;
    font-weight: 700;
    letter-spacing: 0.08em;
    text-transform: uppercase;
  }

  .note-text {
    margin: 0;
    color: rgba(255, 255, 255, 0.88);
    line-height: 1.6;
  }

  .faq-block {
    max-width: var(--h1-faq-max-width);
    margin: 0 auto;
  }

  .faq-item + .faq-item {
    margin-top: var(--h1-faq-item-gap);
  }

  .faq-q {
    margin: 0 0 0.35rem 0;
    color: var(--accent);
    text-transform: uppercase;
    font-size: clamp(1.05rem, 1.25vw, 1.25rem);
  }

  .faq-a {
    margin: 0 0 1rem 0;
    color: #fff;
    line-height: 1.7;
  }
</style>
